YoJsonRequest.urlToResponse={};function YoJsonRequest(a){YoJsonRequest.scriptCounter++;var b=YoJsonRequest.urlToRequestId[a];if(!b){b=YoJsonRequest.scriptCounter;YoJsonRequest.urlToRequestId[a]=b}this.url=a;this.callbackName="onRequestLoad_"+b;this.id=YoJsonRequest.scriptCounter;this.headLoc=document.getElementsByTagName("head").item(0);this.scriptId="JscriptId"+YoJsonRequest.scriptCounter;this.onLoad=null;this.onCancel=null;this.onTimeout=null;this.response=null;this.timeout=null}YoJsonRequest.TIMEOUT_SEC=20;YoJsonRequest.scriptCounter=0;YoJsonRequest.urlToRequestId={};YoJsonRequest.prototype.embed=function(){var b=this;var a=YoJsonRequest.urlToResponse[this.url];if(a){b.response=a;b.onLoad();return}var c=this.callbackName;var d=this.id;window[c]=function(e){b.response=e;clearTimeout(b.timeout);YoJsonRequest.urlToResponse[b.url]=b.response;b.onLoad();b.removeScriptTag()};this.timeout=setTimeout(this.onTimeout,YoJsonRequest.TIMEOUT_SEC*1000);this.buildScriptTag();this.addScriptTag()};YoJsonRequest.prototype.buildScriptTag=function(){this.scriptObj=document.createElement("script");this.scriptObj.setAttribute("type","text/javascript");this.scriptObj.setAttribute("charset","utf-8");var b=this.url+"&callback="+this.callbackName;var c=navigator.appVersion.indexOf("MSIE")!=-1;if(c){var a="&noCacheIE="+(new Date()).getTime();b+="&no_cache="+a}this.scriptObj.setAttribute("src",b);this.scriptObj.setAttribute("id",this.scriptId)};YoJsonRequest.prototype.removeScriptTag=function(){if(this.scriptObj.parentNode){this.headLoc.removeChild(this.scriptObj)}};YoJsonRequest.prototype.addScriptTag=function(){this.headLoc.appendChild(this.scriptObj)};YoJsonRequest.prototype.cancel=function(){delete YoJsonRequest.urlToRequestId[this.url];if(this.timeout!=null){clearTimeout(this.timeout);this.timeout=null}this.removeScriptTag();var a=this.callbackName;window[a]=function(){};this.onCancel()};YoLocationChooser.SERVER_URL="http://widget1.yowindow.com/cgi-bin/wimo/server/index.pl";YoLocationChooser.CLIENT="hpPal";YoLocationChooser.MAJOR_CITY_POPULATION=100*1000;function YoLocationChooser(b,a){this.locale=a;this.rootLine=null;this.scope="major";this.selectedLocation=null;this.enabled=true;removeAllChildNodes(b);this.flowContainer=document.createElement("div");this.flowContainer.id="line_container";b.appendChild(this.flowContainer);var d=document.createElement("div");d.style.margin="10px 0 0 0";d.style.textAlign="left";b.appendChild(d);d.innerHTML='        <input type="radio" name="scope" id="scope_major" value="major" checked="checked" /><label for="scope_major">'+L("Major cities")+'</label><br/>        <input type="radio" name="scope" id="scope_all" value="all"/><label for="scope_all">'+L("All locations")+"</label>    ";var f=document.createElement("div");f.innerHTML='<div id="locationRequesDiv" style="display:none; margin-left:5px; margin-top:5px; font-size:12px; text-align:left;">	<a target="_blank" href="http://yowindow.com/location_request.php">'+L("Cannot find a location?")+"</a></div>";b.appendChild(f);var c=this;var e=function(){c.onScopeClick()};document.getElementById("scope_major").onclick=e;document.getElementById("scope_all").onclick=e;this.rootLine=new Line(this,"world")}YoLocationChooser.prototype.open=function(a){if(a&&YoLocationChooser.normalizePath(this.getPath())==YoLocationChooser.normalizePath(a)){return}if(a=="#auto"){this.requestAutoPath();var b=this.autoPathRequest==null;return}this.rootLine.open(a)};YoLocationChooser.normalizePath=function(c){if(c==null){return null}var b=c.split("/");if(b.length==3){b.splice(1,1)}return b.join("/")};YoLocationChooser.prototype.onScopeClick=function(){var a=document.getElementById("scope_major").checked?"major":"all";if(this.scope==a){return}this.scope=a;this.rootLine.handleScopeChange()};YoLocationChooser.prototype.getMinPopulation=function(){if(this.scope=="major"){return YoLocationChooser.MAJOR_CITY_POPULATION}return 0};YoLocationChooser.prototype.setSelectedLocation=function(b){var c=null;if(b){c=b["@id"]}var a=null;if(this.selectedLocation){a=this.selectedLocation["@id"]}if(a==c){return}this.selectedLocation=b;this.onLocationChange(b)};YoLocationChooser.prototype.requestAutoPath=function(){var b=YoLocationChooser.SERVER_URL+"?request=world&client="+YoLocationChooser.CLIENT+"&id=auto&detail=full&output=json";if(this.locale){b+="&lang="+this.locale}var c=new YoJsonRequest(b);var a=this;c.onTimeout=function(){a.onAutoPathTimeout(c)};c.onLoad=function(){a.onAutoPathLoad(c);a.autoPathRequest=null};c.onCancel=function(){a.onAutoPathCancel(c);a.autoPathRequest=null};a.autoPathRequest=c;c.embed()};YoLocationChooser.prototype.onAutoPathLoad=function(a){var b=a.response.response.l["@path"];if(!b){severe("path="+b)}this.open(b)};YoLocationChooser.prototype.onAutoPathTimeout=function(a){};YoLocationChooser.prototype.onAutoPathCancel=function(a){};YoLocationChooser.prototype.onLocationChange=function(a){};YoLocationChooser.prototype.getPath=function(){var b="";var a=this.rootLine;while(a){var c=a.combo.value;if(c=="#loading"){break}if(c!="#default"){if(b!=""){b+="/"}b=b+c}a=a.childLine}return b==""?null:b};YoLocationChooser.prototype.setEnabled=function(a){this.enabled=a;this.updateEnabled()};YoLocationChooser.prototype.updateEnabled=function(a){var c=this.rootLine;while(c){c.updateEnabled();c=c.childLine}document.getElementById("scope_major").disabled=!this.enabled;document.getElementById("scope_all").disabled=!this.enabled};YoLocationChooser.prototype.setLocationRequestVisible=function(a){var c=document.getElementById("locationRequesDiv");c.style.display=a?"block":"none"};Line.USA=6252001;Line.NUMBER_REGEX=new RegExp("^\\d+$");function Line(j,i,b){var l=this;this.host=j;this.enabled=true;this.type=i;this.id=b;this.scope="major";this.loaded=false;this.pendingPath=null;this.request=null;this.idToNode=null;this.childLine=null;this.combo=null;this.button=null;var a=j.flowContainer;var k=document.createElement("table");k.width="100%";k.cellPadding=1;k.cellSpacing=0;a.appendChild(k);var f=document.createElement("tbody");k.appendChild(f);var h=document.createElement("tr");f.appendChild(h);var e=document.createElement("td");e.width="100%";h.appendChild(e);var d=document.createElement("td");d.width="100px";d.style.width="100px";h.appendChild(d);var c=document.createElement("select");this.combo=c;c.style.width="100%";c.onchange=function(){l.onComboChange()};e.appendChild(c);var g=document.createElement("input");g.type="button";g.value=L("Retry");g.style.width="100px";d.appendChild(g);g.onclick=function(){l.onButtonClick()};this.button=g;this.td2=d;this.ui=k}Line.prototype.dispose=function(){if(this.childLine){this.childLine.dispose();delete this.childLine}var a=this.ui.parentNode;a.removeChild(this.ui);delete this.ui};Line.prototype.open=function(a){this.pendingPath=a;if(!this.loaded){this.load();return}this.processPendingPath()};Line.prototype.load=function(){var b=YoLocationChooser.SERVER_URL+"?request=world&client="+YoLocationChooser.CLIENT+"&output=json";if(this.host.locale){b+="&lang="+this.host.locale}if(this.type=="world"){b+="&id=gn:6295630&depth=2"}else{if(this.type=="locations"){b+="&id=gn:"+this.id}else{if(this.type=="regions"){b+="&id=gn:"+this.id+"&depth=1"}}}if(this.request){this.request.cancel()}this.td2.style.display="none";this.button.value=L("Cancel");var c=new YoJsonRequest(b);var a=this;c.onTimeout=function(){a.onTimeout(c)};c.onLoad=function(){a.onLoad(c);a.request=null};c.onCancel=function(){a.onCancel(c);a.request=null};this.request=c;this.setComboLine("#loading",L("Loading")+"...");c.embed()};Line.prototype.onLoad=function(a){p("request.onLoad(), type="+this.type+", request.id="+a.id);this.lastRequest=a;this.td2.style.display="none";this.enabled=true;this.updateEnabled();this.loaded=true;removeAllChildNodes(this.combo);this.idToNode={};this.fillCombo(a);this.processPendingPath()};Line.prototype.onCancel=function(a){this.td2.style.display="block";this.button.value=L("Retry")};Line.prototype.onTimeout=function(a){severe("request.onTimeout(), id="+a.id);this.enterUpdateErrorState()};Line.prototype.onComboChange=function(){var a=this.combo.value;this.processSelection(a,null)};Line.prototype.onButtonClick=function(){if(this.request){this.request.cancel()}this.load()};Line.prototype.handleScopeChange=function(){if(this.type=="locations"){var a=this.host.scope;this.scope=a;this.updateLocations();return}if(this.childLine){this.childLine.handleScopeChange()}};Line.prototype.updateLocations=function(){var a=this.combo.value;removeAllChildNodes(this.combo);this.idToNode={};this.fillCombo(this.lastRequest);this.open(a)};Line.prototype.processPendingPath=function(){var f=this.pendingPath;var e=null;var g=-1;var h=null;if(this.pendingPath){var b=this.pendingPath.split("/");if(b.length>0){f=b.shift();h=this.findIdForStep(f);if(h!=Line.USA&&this.type=="world"&&b.length==2){b.shift()}e=b.join("/")}}var d=this.idToNode[h];if(d){var c=this.comboFindValue(h);if(c==-1){this.addNodeSorted(d)}if(this.combo.value!=h){this.combo.value=h;if(d.type=="location"){this.host.setSelectedLocation(d);return}}}this.processSelection(h,e);this.pendingPath=null};Line.prototype.processSelection=function(d,c){if(d==null){d="#default"}if(this.childLine){this.childLine.dispose()}var a=this.createChildLine(d);this.childLine=a;if(a!=null){a.open(c);return}var b=this.idToNode[d];if(b&&b.type!="location"){b=null}this.host.setSelectedLocation(b)};Line.prototype.createChildLine=function(a){if(a.indexOf("#")==0&&a!="#allLocations"){return null}if(this.type=="locations"){if(a=="#allLocations"){return new Line(this.host,"locations",this.id)}}else{if(this.type=="world"){if(a==Line.USA){return new Line(this.host,"regions",a)}else{return new Line(this.host,"locations",a)}}else{if(this.type=="regions"){if(a=="#allLocations"){return new Line(this.host,"locations",this.id)}else{return new Line(this.host,"locations",a)}}}}return null};Line.prototype.fillCombo=function(a){if(a.response.response.error){severe(dump(a.response));this.enterUpdateErrorState();return}if(this.type=="world"){this.fillWorld(a);return}else{if(this.type=="regions"){this.fillRegions(a);return}else{if(this.type=="locations"){this.fillLocations(a);return}}}};Line.prototype.fillWorld=function(d){this.addOption(L("Select a country")+"...","#default");var a=new Array();var g=d.response.response.globe.continent;for(var f in g){var h=g[f];var k=h.country;if(k){if(k.length==null){a.push(k)}else{for(var e in k){var b=k[e];b.type="country";a.push(b)}}}var c=h.region;if(c){if(c.length==null){a.push(c)}else{for(var e in c){var b=c[e];b.type="region";a.push(b)}}}}this.fillNodesSorted(a)};Line.prototype.fillRegions=function(d){var c=L("Select a region")+"...";if(this.id==Line.USA){c=L("Select a state")+"..."}this.addOption(c,"#default");if(this.id==Line.USA){this.addOption("["+L("All states")+"]","#allLocations")}var a=d.response.response;var b=new Array();jsonTraverse(a,function(h,f){if(h=="region"){if(f.constructor==Array){var e=f;for(var g in e){var j=e[g];j.type="region";b.push(j)}}else{var j=f;j.type="region";b.push(j)}}return true});this.fillNodesSorted(b)};Line.prototype.fillLocations=function(c){this.addOption(L("Select a location")+"...","#default");var a=c.response.response;var b=new Array();jsonTraverse(a,function(g,e){if(g=="l"){if(e.constructor==Array){var d=e;for(var f in d){var h=d[f];h.type="location";b.push(h)}}else{var h=e;h.type="location";b.push(h)}return false}return true});this.fillNodesSorted(b)};Line.prototype.fillNodesSorted=function(a){var l=this.host.getMinPopulation();var n=this.combo.parentNode;n.removeChild(this.combo);var f;var j=new Date();a.sort(Line.nodeCompare);var k=this.combo.options.length;for(var g in a){var d=a[g];var b=d["@id"];this.idToNode[b]=d;var e=d["@p"];if(e!=null&&e<l){continue}var m=d["@name_loc"];if(!m){m=d["@name"]}this.combo.options[k]=new Option(m,b);k++}var h=new Date();var c=(h.getTime()-j.getTime())/1000;n.appendChild(this.combo)};Line.prototype.addNodeSorted=function(g){var f=null;var h=g["@name_loc"];if(!h){h=g["@name"]}for(var d in this.combo.children){var a=this.combo.children[d];var c=a.text;if(!a.value){continue}var e=a.value.indexOf("#")==0;if(e){continue}if(c>h){f=a;break}}var b=h;var a=document.createElement("option");a.value=g["@id"];a.appendChild(document.createTextNode(b));if(f){this.combo.insertBefore(a,f)}else{this.combo.appendChild(a,f)}};Line.nodeCompare=function(f,d){if(!f){return -1}if(!d){return 1}if(f["@name_loc"]&&!(d["@name_loc"])){return -1}if(d["@name_loc"]&&!(f["@name_loc"])){return 1}var e=f["@name_loc"];if(!e){e=f["@name"]}var c=d["@name_loc"];if(!c){c=d["@name"]}if(!e){p("na="+e+", id="+f)}if(e.toLowerCase()<c.toLowerCase()){return -1}if(e.toLowerCase()>c.toLowerCase()){return 1}return 0};Line.prototype.addOption=function(b,c){var a;a=document.createElement("option");a.value=c;a.appendChild(document.createTextNode(b));this.combo.appendChild(a)};Line.prototype.getSelectedNode=function(){var b=this.combo.value;var a=this.idToNode[b];return a};Line.prototype.comboFindValue=function(c){for(var a=0;a<this.combo.options.length;a++){var b=this.combo.options[a];if(b){if(c===b.value){return a}}}return -1};Line.prototype.findIdForStep=function(b){var c=null;if(!b){return null}if(b.indexOf("#")==0){return b}else{if(b.match(Line.NUMBER_REGEX)){return b}}var a=b;var c=this.findIdForName(a);return c};Line.prototype.findIdForName=function(a){var d=null;for(var d in this.idToNode){var b=this.idToNode[d];var c=null;if(b){c=b["@name_loc"];if(!c){c=b["@name"]}}if(c==a){return b["@id"]}}return null};Line.prototype.enterUpdateErrorState=function(b){this.td2.style.display="block";this.button.value=L("Retry");removeAllChildNodes(this.combo);var a;a=document.createElement("option");a.value="error";a.appendChild(document.createTextNode(L("Update error")));this.combo.appendChild(a)};Line.prototype.setComboLine=function(d,b){removeAllChildNodes(this.combo);var c=this.combo.parentNode;c.removeChild(this.combo);var a;a=document.createElement("option");a.value=d;a.appendChild(document.createTextNode(b));this.combo.appendChild(a);this.enabled=false;this.updateEnabled();c.appendChild(this.combo)};Line.prototype.updateEnabled=function(){var a=this.enabled&&this.host.enabled;this.combo.disabled=!a};function removeAllChildNodes(a){if(a&&a.hasChildNodes&&a.removeChild){while(a.hasChildNodes()){a.removeChild(a.firstChild)}}}function jsonTraverse(d,c){for(var b in d){var a=c.apply(this,[b,d[b]]);if(!a){continue}if(typeof(d[b])=="object"){!jsonTraverse(d[b],c)}}}function jsonFirstChild(b){for(var a in b){if(typeof(b[a])=="object"){return b[a]}}return null}function RsUtil(){}RsUtil.getLocale=function(){var a=navigator.userLanguage;if(!a){a=navigator.language}if(!a){a=navigator.browserLanguage}return a};RsUtil.getLanguage=function(){var c=RsUtil.getLocale();var a=c.indexOf("-");if(a==-1){a=c.indexOf("_")}var b=c;if(a!=-1){b=c.substring(0,a)}return b.toLowerCase()};RsUtil.getLocaleCountry=function(){var c=RsUtil.getLocale();var a=c.indexOf("-");if(a==-1){a=c.indexOf("_")}if(a==-1){return null}var b=c.substring(a+1);if(!b){return null}return b.toLowerCase()};RsUtil.getAutoUnitSystem=function(a){var b=new Date(77,11-1,5,20,0);var c=b.toLocaleString();if(c.indexOf("ноября")!=-1){return"russia"}var d=this.getLocaleCountry();if(d=="gb"||d=="ie"){return"uk"}if(RsUtil.isUsa()){return"us"}return"metric"};RsUtil.getAutoTimeFormat=function(){var a=new Date(77,11-1,5,20,0);var b=a.toLocaleString();if(RsUtil.isUsa()){return"12"}return"24"};RsUtil.isUsa=function(){var a=new Date(77,11-1,5,20,0);var b=a.toLocaleString();return b.lastIndexOf("PM")==(b.length-2)||b.indexOf("8:00")!=-1};RsUtil.formatIsoDateAndTime=function(e,d){if(e==null){return null}if(d=="local"){d=-e.getTimezoneOffset()/60}var c=formatIsoDate(e)+"T"+zeroPad(e.getHours())+":"+zeroPad(e.getMinutes())+":"+zeroPad(e.getSeconds());if(d==0){c+="Z"}else{if(!isNaN(d)){if(d>0){c+="+"}if(d<0){c+="-";d=-d}var b=Math.floor(d);var a=Math.round(60*(d-b));c+=zeroPad(b);if(a!=0){c+=":"+zeroPad(a)}}}return c};function formatIsoDate(a){if(a==null){return null}return a.getFullYear()+"-"+zeroPad(a.getMonth()+1)+"-"+zeroPad(a.getDate())}function zeroPad(a){var b=""+a;if(b.length==1){return"0"+b}return a+""}RsUtil.equalLocationId=function(d,c){var e=d.indexOf(":");if(e==-1){d="gn:"+d}e=c.indexOf(":");if(e==-1){c="gn:"+c}return d==c};RsUtil.createDelegate=function(e,g,c,b,a){var f=new Array();for(var d=2;d<arguments.length;++d){f.push(arguments[d])}return function(){var h=f.slice(0);for(var j=0;j<arguments.length;++j){h.push(arguments[j])}return g.apply(e,h)}};function getCheckedButton(a){for(var b=0;b<a.length;b++){if(a[b].checked){return a[b]}}return null}function checkButton(a,d){for(var c=0;c<a.length;c++){var b=a[c];b.checked=b.id==d}}RsUtil.haveHieroglyph=function(a){return RsUtil.haveChineseChars(a)||RsUtil.haveJapaneseChars(a)||RsUtil.haveKoreanChars(a)};RsUtil.haveExoticChars=function(a){return RsUtil.haveHieroglyph(a)||RsUtil.haveArabicChars(a)};RsUtil.haveChineseChars=function(a){return/^[\u4E00-\u9FA5]+$/.test(a)};RsUtil.haveJapaneseChars=function(a){return/^[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]+$/.test(a)};RsUtil.haveKoreanChars=function(a){return/^[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]+$/.test(a)};RsUtil.haveArabicChars=function(a){return/^[\u0600-\u06FF]+$/.test(a)};severe=function(a){if(a==null){a="null"}console.log("[SEVERE] "+a)};function isIE(){var a=navigator.userAgent.toLowerCase();return(a.indexOf("msie")!=-1)?parseInt(a.split("msie")[1]):false}function formatQueryFromMap(b){if(b==null){return""}var c=[];for(var a in b){if(b.hasOwnProperty(a)){c.push(encodeURIComponent(a)+"="+encodeURIComponent(b[a]))}}return c.join("&")}
/*
 * jQuery-ajaxTransport-XDomainRequest - v1.0.4 - 2015-03-05
 * https://github.com/MoonScript/jQuery-ajaxTransport-XDomainRequest
 * Copyright (c) 2015 Jason Moon (@JSONMOON)
 * Licensed MIT (/blob/master/LICENSE.txt)
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){module.exports=a(require("jquery"))}else{try{a(jQuery)}catch(b){}}}}(function(b){if(b.support.cors||!b.ajaxTransport||!window.XDomainRequest){return b}var c=/^(https?:)?\/\//i;var d=/^get|post$/i;var a=new RegExp("^(//|"+location.protocol+")","i");b.ajaxTransport("* text html xml json",function(f,h,g){if(!f.crossDomain||!f.async||!d.test(f.type)||!c.test(f.url)||!a.test(f.url)){return}var e=null;return{send:function(l,j){var i="";var k=(h.dataType||"").toLowerCase();e=new XDomainRequest();if(/^\d+$/.test(h.timeout)){e.timeout=h.timeout}e.ontimeout=function(){j(500,"timeout")};e.onload=function(){var s="Content-Length: "+e.responseText.length+"\r\nContent-Type: "+e.contentType;var m={code:200,message:"success"};var o={text:e.responseText};try{if(k==="html"||/text\/html/i.test(e.contentType)){o.html=e.responseText}else{if(k==="json"||(k!=="text"&&/\/json/i.test(e.contentType))){try{o.json=b.parseJSON(e.responseText)}catch(r){m.code=500;m.message="parseerror"}}else{if(k==="xml"||(k!=="text"&&/\/xml/i.test(e.contentType))){var q=new ActiveXObject("Microsoft.XMLDOM");q.async=false;try{q.loadXML(e.responseText)}catch(r){q=undefined}if(!q||!q.documentElement||q.getElementsByTagName("parsererror").length){m.code=500;m.message="parseerror";throw"Invalid XML: "+e.responseText}o.xml=q}}}}catch(n){throw n}finally{j(m.code,m.message,o,s)}};e.onprogress=function(){};e.onerror=function(){j(500,"error",{text:e.responseText})};if(h.data){i=(b.type(h.data)==="string")?h.data:b.param(h.data)}e.open(f.type,f.url);e.send(i)},abort:function(){if(e){e.abort()}}}});return b}));RsUtil.asyncLoad=function(a){if(isIE()){var b=a.url+"?"+formatQueryFromMap(a.data);$.getJSON(b).done(function(c){if(a.success){a.success(c,null,null)}});return}$.ajax({url:a.url,data:a.data,timeout:a.timeout,success:function(d,e,c){if(a.success){a.success(d,e,c)}},error:function(c,e,d){if(a.error){a.error(c,e,d)}},complete:function(c,d){if(a.complete){a.complete(d,c)}}})};var myTraceText="";function severe(a){p("[SEVERE] "+a)}function p(b){myTraceText+=b+"\n";var a=document.getElementById("trace_area");if(a){a.value+=b+"\n"}}function dump(c,e){var a="\t";if(!e){e=""}var b="";if(c.constructor==Array){b+="[\n";for(var d=0;d<c.length;d++){b+=e+a+dump(c[d],e+a)+"\n"}b+=e+"]"}else{if(c.constructor==Object){b+="{\n";for(var d in c){b+=e+a+d+": "+dump(c[d],e+a)+"\n"}b+=e+"}"}else{b+=c}}return b}function L(b){if(window.LOCALE_STRINGS){var a=LOCALE_STRINGS[b];if(a){return a}}return b};